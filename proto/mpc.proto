syntax = "proto3";
package meesign;

service MPC {
    rpc Register(RegistrationRequest) returns (Resp);
    rpc Sign(SignRequest) returns (Task);
    rpc Group(GroupRequest) returns (Task);
    rpc GetTask(TaskRequest) returns (Task);
    rpc UpdateTask(TaskUpdate) returns (Resp);
    rpc GetInfo(InfoRequest) returns (Info);
    rpc GetDevices(DevicesRequest) returns (Devices);
    rpc GetArchived(ArchivedRequest) returns (Archived);
}

enum Protocol {
    GG18 = 0;
}

message RegistrationRequest {
    bytes id = 1;
    string name = 2;
}

message GroupRequest {
    repeated bytes device_ids = 1;
    string name = 2;
    optional uint32 threshold = 3;
    optional Protocol protocol = 4;
}

message Group {
    bytes id = 1;
    string name = 2;
    uint32 threshold = 3;
    repeated bytes device_ids = 4;
}

message DevicesRequest {
    // Protocol
}

message Devices {
    repeated Device devices = 1;
}

message Device {
    bytes id = 1;
    string name = 2;
}

message SignRequest {
    bytes group_id = 1;
    bytes data = 2;
}

message TaskRequest {
     bytes task_id = 1;
     optional bytes device_id = 2;
}

message Task {
    bytes id = 1;
    enum TaskType {
        GROUP = 0;
        SIGN = 1;
    }
    TaskType type = 2;
    enum TaskState {
        WAITING = 0;
        FINISHED = 1;
        FAILED = 2;
    }
    TaskState state = 3;
    int32 progress = 4;
    repeated bytes data = 5;
    optional bytes work = 6;
}

message TaskUpdate {
    bytes device = 1;
    bytes task = 2;
    bytes data = 3;
}

message InfoRequest {
    bytes device_id = 1;
}

message Info {
    repeated Group groups = 1;
    repeated Task tasks = 2;
}

message Resp {
    oneof variant {
        string success = 1;
        string failure = 2;
    }
}

message ArchivedRequest {
    bytes device_id = 1;
}

message Archived {
    repeated Task tasks = 1;
}

message GG18KeyGenInit {
  uint32 index = 1;
  uint32 parties = 2;
  uint32 threshold = 3;
}

message GG18SignInit {
  repeated uint32 indices = 1;
  uint32 index = 2;
  bytes hash = 3;

}

message GG18Message {
  repeated bytes message = 1;
}
